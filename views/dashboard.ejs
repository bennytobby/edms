<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="/styles/index.css" />
  </head>
  <body>
    <div class="container">
      <h1>Welcome, <%= firstname %>!</h1>
      <p>You are logged in as <strong><%= email %></strong>.</p>

      <hr />

      <h2>Upload a Document</h2>
      <form action="/upload" method="post" enctype="multipart/form-data">
        <label>
          Choose File:
          <input type="file" name="document" required />
        </label>
        <br /><br />

        <label>
          Description:
          <input
            type="text"
            name="description"
            placeholder="Brief description..."
          />
        </label>
        <br /><br />

        <label>
          Tags (comma-separated):
          <input type="text" name="tags" placeholder="finance,invoice,etc." />
        </label>
        <br /><br />

        <button type="submit">Upload</button>
      </form>

      <hr />

      <h2>Existing Files</h2>

      <!-- Search Bar -->
      <form action="/dashboard" method="get">
        <input
          type="text"
          name="search"
          placeholder="Search files..."
          value="<%= search || '' %>"
        />
        <button type="submit">Search</button>
      </form>

      <br />

      <% if (files.length === 0) { %>
      <p>No files found.</p>
      <% } else { %>
      <table>
        <tr>
          <th>Filename</th>
          <th>Uploaded By</th>
          <th>Uploaded On</th>
          <th>Description</th>
          <th>Tags</th>
          <th>Actions</th>
        </tr>
        <% files.forEach(file => { %>
        <tr>
          <td><%= file.originalName %></td>
          <td><%= file.uploadedBy %></td>
          <td><%= new Date(file.uploadDate).toLocaleString() %></td>
          <td><%= file.description || "—" %></td>
          <td>
            <%= file.tags && file.tags.length ? file.tags.join(", ") : "—" %>
          </td>
          <td>
            <a href="/download/<%= file.filename %>">Download</a>
            <a
              href="/delete/<%= file.filename %>"
              onclick="return confirm('Are you sure you want to delete this file?');"
              >Delete</a
            >
          </td>
        </tr>
        <% }); %>
      </table>
      <% } %>

      <hr />
      <a href="/logout">Logout</a>
    </div>
  </body>
</html>
